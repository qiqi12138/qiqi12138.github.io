<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    <title>
      
      mongoose - qiqi12138
      
		</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/icons.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    
    <link href="https://fonts.googleapis.com/css?family=Bree+Serif|Lato:100,100i,300,300i,400,400i,700,700i|Source+Code+Pro:300,400,500,700" rel="stylesheet">
    

    
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/bigfoot/dist/bigfoot.js"></script>
    <link rel="stylesheet" type="text/css" href="/assets/bigfoot/dist/bigfoot-number.css" />
    <script type="text/javascript">
        $.bigfoot();
    </script>
    
    
</head>

    <body class="post-template">
        <header class="main-header">
	<div class="main-header-content">
		<h1 class="blog-title">
			<a href="/">
				
           qiqi12138
				
			</a>
		</h1>
		<h2 class="blog-description"></h2>
	</div>

	<div class="nav">
    
		
	</div>
</header>

        
<main class="content" role="main">
  <article class="post">
    <header class="post-header">
      
      <h2 class="post-title">mongoose</h2>
      <section class="post-meta">
        <time class="post-date">November 21, 2018</time>
      </section>
    </header>
    <section class="post-content">
      

<h1 id="mongoose">mongoose</h1>

<ul>
<li>官网：<a href="http://mongoosejs.com/">http://mongoosejs.com/</a></li>
<li>官方指南：<a href="http://mongoosejs.com/docs/guide.html">http://mongoosejs.com/docs/guide.html</a></li>
<li>官方API文档：<a href="http://mongoosejs.com/docs/api.html">http://mongoosejs.com/docs/api.html</a></li>
</ul>

<h2 id="1-mongodb-数据库的基本概念">1.MongoDB 数据库的基本概念</h2>

<ul>
<li>可以有多个数据库</li>
<li>一个数据库中可以有多个集合 (表) collections</li>
<li>一个集合中可以有多个文档 (表记录)</li>
<li>文档结构很灵活，没有任何限制</li>

<li><p>MongoDB 非常灵活，不需要像 MySQL 一样先创建数据库、表、设计表结构</p>

<ul>
<li>在这里只需要：当你需要插入数据的时候，只需要指定往哪个数据库的哪个集合操作就可以了</li>

<li><p>一切都由 MongoDB 来帮你自动完成建库建表这件事儿</p>

<pre><code class="language-js">{
qq: {
users: [
{name: &quot;张三&quot;, age: 15},  
{name: &quot;李四&quot;, age: 15},  
{name: &quot;王五&quot;, age: 15},  
{name: &quot;张三123&quot;, age: 15},  
{name: &quot;张三321&quot;, age: 18},
...
],
products: [
        
],
...    
},
taobao: {
      
},
baidu: {
      
}
}
</code></pre></li>
</ul></li>
</ul>

<h2 id="2-起步">2.起步</h2>

<p>安装:</p>

<pre><code class="language-shell">npm i mongoose
</code></pre>

<p>hello world:</p>

<pre><code class="language-js">const mongoose = require('mongoose');

// 连接 MongoDB 数据库
mongoose.connect('mongodb://localhost:27017/test', { useNewUrlParser: true });

// 创建一个模型
// 就是在设计数据库
// MongoDB 是动态的，非常灵活，只需要在代码中设计你的数据库就可以了
// mongoose 这个包就可以让你的设计编写过程变的非常的简单
const Cat = mongoose.model('Cat', { name: String });// 表明叫 Cat 表里有个 name 是字符串


// 实例化一个 Cat
const kitty = new Cat({ name: 'Zildjian' });

// 持久化保存 kitty 实例
kitty.save().then(() =&gt; console.log('meow'));
</code></pre>

<h2 id="3-官方指南">3. 官方指南</h2>

<h3 id="3-1-设计-schema-发布-model">3.1 设计 Schema 发布 Model</h3>

<pre><code class="language-javascript">const mongoose = require('mongoose')

var Schema = mongoose.Schema

/**
 * 1. 连接数据库
 */
mongoose.connect('mongodb://localhost:27017/itcast')

/**
 * 2. 设计集合结构 (表结构)
 */
var userSchema = new Schema({
  username: {
    type: String,
    required: true // 必须有
  },
  password: {
    type: String,
    required: true // 必须有
  },
  email: {
    type: String
  }
})

/**
 * 3. 将文档结构发布为模型
 */
const User = mongoose.model('User', userSchema)

/**
 * 4. 当我们有了模型构造函数之后，就可以使用这个构造函数对 users 集合中的数据为所欲为了 (增删改查)
 */

</code></pre>

<h3 id="3-2-增加数据">3.2 增加数据</h3>

<pre><code class="language-javascript">var admin = new User({
  username: 'admin',
  password: '123456',
  email: 'admin@admin.com'
})

admin.save(function (err, ret) {  
  if (err) { 
    console.log('保存失败') 
  } else {
    console.log('保存成功')
    console.log(ret)
  }
})
</code></pre>

<h3 id="3-3-查询">3.3 查询</h3>

<p>查询所有</p>

<pre><code class="language-js">// 查询所有
User.find(function (err, ret) {  
  if (err) {
    console.log('查询失败')
  } else {
    console.log(ret)
  }
})
</code></pre>

<p>按条件查询所有</p>

<pre><code class="language-js">User.find({
  username: '张三'
},function (err, ret) {  
  if (err) {
    console.log('查询失败')
  } else {
    console.log(ret)
  }
})
</code></pre>

<p>按条件查询单个</p>

<pre><code class="language-js">User.findOne({
  username: '张三'
},function (err, ret) {  
  if (err) {
    console.log('查询失败')
  } else {
    console.log(ret)
  }
})
</code></pre>

<h3 id="3-4-删除数据">3.4 删除数据</h3>

<p>根据条件删除所有</p>

<pre><code class="language-javascript">User.remove({
  username: '张三'
}, function (err, ret) {  
  if (err) {
    console.log('删除失败')
  } else {
    console.log('删除成功')
    console.log(ret)
  }
})
</code></pre>

<p>根据条件删除一个</p>

<pre><code class="language-javascript">Model.findOneAndRemove(conditions, [options], [callback])
</code></pre>

<p>根据 id 删除一个</p>

<pre><code class="language-js">Model.findByIdAndRemove(conditions, [options], [callback])
</code></pre>

<h3 id="3-5-更新数据">3.5 更新数据</h3>

<p>根据条件更新所有</p>

<pre><code class="language-js">Model.update(conditions, doc, [options], [callback])
</code></pre>

<p>根据指定条件更新一个</p>

<pre><code class="language-js">Model.findOneAndUpdate([conditions], [update], [options], [callback])
</code></pre>

<p>根据 id 更新一个</p>

<pre><code class="language-js">User.findByIdAndUpdate('5d4a82204a84c863c441af6b', {
  password: '1223'
}, function (err, ret) {  
  if (err) {
    console.log('更新失败')
  } else {
    console.log('更新成功')
  }
})
</code></pre>

    </section>
    <footer class="post-footer">
      
    </footer>
  </article>
</main>

        <footer class="site-footer">
  <section class="rss"><a class="subscribe-button icon-feed" href="/index.xml"></a></section>
  
  
  <section class="copyright">&copy; 2019 qiqi12138</section>
  <section class="poweredby"><a href="http://thedarkroast.com/arabica">Arabica</a> theme by Sean Lunsford. Published with <a href="https://gohugo.io">Hugo</a>.</section>
</footer>



    </body>
</html>
